<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> LAPAK DIKA - 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --brand: #4318FF; --green: #05CD99; --red: #EE5D50; --bg: #0b0e14; --gold: #FFD700; --blue: #00D1FF; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; color: white; padding: 20px;
            background: linear-gradient(rgba(11, 14, 20, 0.94), rgba(11, 14, 20, 0.94)), url('https://i.ibb.co.com/ymMgzjjQ/3a8d2a531fd9a32c02655b65ee244fe9.jpg');
            background-size: cover; background-attachment: fixed; min-height: 100vh;
        }
        .nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 18px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .logo-premium { font-weight: 800; font-size: 22px; letter-spacing: -1px; text-transform: uppercase; display: flex; align-items: center; gap: 2px; }
        .logo-premium span:first-child { color: white; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .logo-premium span:last-child { background: linear-gradient(135deg, var(--brand), var(--blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 8px rgba(67, 24, 255, 0.5)); position: relative; }
        .logo-premium span:last-child::after { content: ''; position: absolute; bottom: 2px; left: 0; width: 100%; height: 2px; background: var(--brand); border-radius: 10px; box-shadow: 0 0 10px var(--brand); }
        .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: #0b0e14; z-index: 3000; transition: 0.3s; padding: 30px 20px; box-sizing: border-box; border-right: 1px solid rgba(255,255,255,0.1); }
        .sidebar.active { left: 0; }
        .side-btn { width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-weight: 700; text-align: left; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
        .side-btn:hover { background: rgba(255,255,255,0.1); border-left: 4px solid var(--brand); }
        .search-box { position: relative; margin-bottom: 15px; width: 100%; }
        .search-box i { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: rgba(255,255,255,0.3); }
        .search-box input { width: 100%; padding: 16px 16px 16px 48px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 18px; color: white; font-family: inherit; font-weight: 600; outline: none; box-sizing: border-box; }
        .filter-tags { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 10px; scrollbar-width: none; }
        .tag { padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 12px; font-weight: 700; white-space: nowrap; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
        .tag.active { background: var(--brand); border-color: var(--brand); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; text-align: center; background: rgba(255,255,255,0.05); border-radius: 12px; cursor: pointer; font-weight: 800; border: 1px solid rgba(255,255,255,0.1); }
        .tab.active { background: var(--brand); border-color: var(--brand); box-shadow: 0 4px 15px rgba(67, 24, 255, 0.3); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 22px; border: 1px solid rgba(255,255,255,0.1); text-align: center; position: relative; }
        .card img { width: 100%; height: 120px; object-fit: cover; border-radius: 16px; margin-bottom: 10px; }
        .badge-cat { position: absolute; top: 20px; left: 20px; background: var(--brand); font-size: 9px; padding: 3px 8px; border-radius: 6px; font-weight: 800; text-transform: uppercase; }
        .btn-buy { width: 100%; padding: 12px; border-radius: 12px; background: var(--brand); color: white; border: none; font-weight: 800; cursor: pointer; }
        .history-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 18px; margin-bottom: 12px; border-left: 5px solid var(--brand); text-align: left; position: relative; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 2500; backdrop-filter: blur(8px); }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #141822; padding: 25px; border-radius: 30px; width: 88%; max-width: 380px; z-index: 4000; display: none; border: 1px solid rgba(255, 255, 255, 0.15); max-height: 85vh; overflow-y: auto; }
        #chat-box { height: 250px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 15px; margin-bottom: 10px; text-align: left; font-size: 14px; }
        input, textarea { width: 100%; padding: 14px; margin-top: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: white; box-sizing: border-box; outline: none; font-family: inherit; }
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: #222; padding: 12px 20px; border-radius: 15px; display: flex; align-items: center; gap: 12px; z-index: 9999; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
        #toast.active { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div class="sidebar" id="side">
        <div class="logo-premium" style="margin-bottom: 30px;"><span>LAPAK</span><span>DIKA</span></div>
        <div id="adm-menu"></div>
        <button class="side-btn" onclick="opCalc()"><i class="fas fa-calculator" style="color:var(--red);"></i> KALKULATOR</button>
        <button class="side-btn" onclick="opRed()"><i class="fas fa-ticket-alt" style="color:var(--gold);"></i> REDEEM KODE</button>
        <button class="side-btn" onclick="opReq()"><i class="fas fa-paper-plane" style="color:var(--green);"></i> JASA POST</button>
        <button class="side-btn" onclick="opAi()"><i class="fas fa-robot" style="color:var(--blue);"></i> TANYA DIKA AI</button>
        <button class="side-btn" onclick="opTesti()"><i class="fas fa-star" style="color:var(--gold);"></i> TESTIMONI</button>
        <button class="side-btn" onclick="showTop()"><i class="fas fa-crown" style="color:var(--gold);"></i> TOP BUYER</button>
        <button class="side-btn" onclick="logout()" style="margin-top:50px; background:var(--red); border:none; color:white;"><i class="fas fa-sign-out-alt"></i> KELUAR</button>
    </div>

    <div class="nav">
        <i class="fas fa-bars-staggered" onclick="toggleSide()" style="cursor:pointer; font-size: 20px;"></i>
        <div class="logo-premium"><span>LAPAK</span><span>DIKA</span></div>
        <div id="u-bal" style="color:var(--green); font-weight:800; background: rgba(5, 205, 153, 0.1); padding: 5px 12px; border-radius: 10px;">Rp 0</div>
    </div>

    <div class="tabs">
        <div class="tab active" id="t-kat" onclick="sw('kat')">KATALOG</div>
        <div class="tab" id="t-his" onclick="sw('his')">RIWAYAT</div>
    </div>

    <div id="p-kat">
        <div class="search-box"><i class="fas fa-search"></i><input type="text" id="searchInput" placeholder="Cari item..." oninput="search()"></div>
        <div class="filter-tags">
            <div class="tag active" onclick="filterCat('ALL', this)">SEMUA</div>
            <div class="tag" onclick="filterCat('AKUN', this)">AKUN</div>
            <div class="tag" onclick="filterCat('ITEM', this)">ITEM</div>
            <div class="tag" onclick="filterCat('JASA', this)">JASA</div>
        </div>
        <div id="product-list"></div>
    </div>

    <div id="p-his" style="display:none;"><div id="history-content"></div></div>

    <div class="overlay" id="ov" onclick="cls()"></div>

    <div class="modal" id="m-testi"><h3>TESTIMONI</h3><div id="testi-list"></div><button class="btn-buy" onclick="cls()" style="margin-top:15px;">MANTAP</button></div>
    <div class="modal" id="m-ai"><h3>DIKA AI</h3><div id="chat-box">Halo bang! Tanya apa aja...</div><input type="text" id="chat-in" placeholder="Ketik pesan..."><button class="btn-buy" style="margin-top:10px;" onclick="askAi()">KIRIM</button></div>
    <div class="modal" id="m-req"><h3>JASA POST</h3><input type="text" id="r-game" placeholder="Nama Game"><input type="number" id="r-price" placeholder="Harga"><input type="text" id="r-wa" placeholder="WhatsApp"><textarea id="r-desc" placeholder="Deskripsi"></textarea><input type="file" id="r-img"><button class="btn-buy" style="margin-top:20px;" onclick="sendReq()">AJUKAN</button></div>
    <div class="modal" id="m-red"><h3>REDEEM KODE</h3><input type="text" id="red-code" placeholder="Kode Voucher"><button class="btn-buy" style="margin-top:20px;" onclick="redeem()">TUKAR</button></div>
    <div class="modal" id="m-calc"><h3>KALKULATOR</h3><input type="text" id="calc-display" readonly style="text-align: right; font-size: 24px;"><div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top:10px;"><button class="btn-buy" onclick="calcIn('7')">7</button><button class="btn-buy" onclick="calcIn('8')">8</button><button class="btn-buy" onclick="calcIn('9')">9</button><button class="btn-buy" style="background:var(--red)" onclick="calcClear()">C</button><button class="btn-buy" onclick="calcIn('4')">4</button><button class="btn-buy" onclick="calcIn('5')">5</button><button class="btn-buy" onclick="calcIn('6')">6</button><button class="btn-buy" onclick="calcIn('/')">/</button><button class="btn-buy" onclick="calcIn('1')">1</button><button class="btn-buy" onclick="calcIn('2')">2</button><button class="btn-buy" onclick="calcIn('3')">3</button><button class="btn-buy" onclick="calcIn('*')">x</button><button class="btn-buy" onclick="calcIn('0')">0</button><button class="btn-buy" onclick="calcIn('.')">.</button><button class="btn-buy" onclick="calcRes()">=</button><button class="btn-buy" onclick="calcIn('+')">+</button></div></div>
    <div class="modal" id="m-top"><h3>üèÜ TOP SULTAN</h3><div id="top-list"></div><button class="btn-buy" onclick="cls()" style="margin-top:10px;">OKE</button></div>
    <div class="modal" id="m-conf"><h3>KONFIRMASI</h3><p id="conf-msg" style="text-align:center; opacity:0.8;"></p><div style="display: flex; gap: 10px; margin-top: 20px;"><button onclick="cls()" style="flex:1; padding:12px; border-radius:12px; background:rgba(255,255,255,0.1); color:white; border:none;">BATAL</button><button id="conf-yes" style="flex:1; padding:12px; border-radius:12px; background:var(--brand); color:white; border:none;">YA</button></div></div>

    <script>
        const _s = supabase.createClient('https://pmoqjgovghxibdcxpqql.supabase.co', 'sb_publishable_eXCMrrASbuEqLkNzjAMT5A_SM5GQRH6')
        const mail = localStorage.getItem('userEmail');
        const adminWA = "6283121495921";
        let allProducts = [], userBalance = 0;

        function msg(text, icon = 'info-circle') { const t = document.getElementById('toast'); t.innerHTML = `<i class="fas fa-${icon}" style="color:var(--brand)"></i> <b>${text}</b>`; t.classList.add('active'); setTimeout(() => t.classList.remove('active'), 3000); }
        function ask(text, callback) { cls(); document.getElementById('conf-msg').innerText = text; document.getElementById('m-conf').style.display = 'block'; document.getElementById('ov').style.display = 'block'; document.getElementById('conf-yes').onclick = () => { callback(); cls(); }; }
        function toggleSide() { document.getElementById('side').classList.toggle('active'); document.getElementById('ov').style.display = document.getElementById('side').classList.contains('active') ? 'block' : 'none'; }
        function cls() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); document.getElementById('side').classList.remove('active'); document.getElementById('ov').style.display = 'none'; }
        
        function sw(t) {
            document.getElementById('p-kat').style.display = t === 'kat' ? 'block' : 'none';
            document.getElementById('p-his').style.display = t === 'his' ? 'block' : 'none';
            document.getElementById('t-kat').className = t === 'kat' ? 'tab active' : 'tab';
            document.getElementById('t-his').className = t === 'his' ? 'tab active' : 'tab';
            if(t === 'his') loadHistory();
        }

        async function loadData() {
            const { data: p } = await _s.from('products').select('*').eq('status', 'READY').order('id', { ascending: false });
            allProducts = p || []; renderProducts(allProducts);
            const { data: u } = await _s.from('profiles').select('balance').eq('email', mail).single();
            if(u) { userBalance = u.balance; document.getElementById('u-bal').innerText = `Rp ${userBalance.toLocaleString()}`; }
        }

        function renderProducts(items) {
            const list = document.getElementById('product-list');
            if (!items.length) { list.innerHTML = `<p style="text-align:center; opacity:0.5; padding:50px;">Stok kategori ini belum tersedia bang.</p>`; return; }
            let html = '<div class="grid">';
            items.forEach(p => { 
                html += `
                <div class="card">
                    <div class="badge-cat">${p.category || 'AKUN'}</div>
                    <img src="${p.image_url}">
                    <b>${p.name}</b><br>
                    <span>Rp ${p.price.toLocaleString()}</span>
                    <button class="btn-buy" style="margin-top:10px;" onclick="buyProduct(${p.id}, ${p.price}, '${p.name}')">BELI</button>
                </div>`; 
            });
            list.innerHTML = html + '</div>';
        }

        function filterCat(cat, el) {
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            if(cat === 'ALL') renderProducts(allProducts);
            else renderProducts(allProducts.filter(p => (p.category || 'AKUN') === cat));
        }

        async function buyProduct(id, price, name) {
            if (userBalance < price) return msg("Saldo kurang!");
            ask(`Beli ${name}?`, async () => {
                const { data: p } = await _s.from('products').select('*').eq('id', id).single();
                await _s.from('profiles').update({ balance: userBalance - price }).eq('email', mail);
                await _s.from('products').update({ status: 'SOLD' }).eq('id', id);
                await _s.from('orders').insert([{ user_email: mail, product_name: name, price: price, secure_data: p.payment_info }]);
                msg("Berhasil!"); location.reload();
            });
        }

        async function loadHistory() {
            const content = document.getElementById('history-content');
            const { data: o } = await _s.from('orders').select('*').eq('user_email', mail).order('id', { ascending: false });
            let html = '<h4>DATA TRANSAKSI</h4>';
            if(!o || o.length === 0) html += '<p style="opacity:0.5; text-align:center;">Belum ada riwayat.</p>';
            o?.forEach(x => { html += `<div class="history-item"><b>${x.product_name}</b><br><small style="color:var(--green)">${x.secure_data}</small><i class="fas fa-copy" style="position:absolute; right:15px; top:40%; color:var(--brand); cursor:pointer;" onclick="navigator.clipboard.writeText('${x.secure_data}');msg('Disalin!')"></i></div>`; });
            content.innerHTML = html;
        }

        function opTesti() { cls(); document.getElementById('m-testi').style.display = 'block'; document.getElementById('ov').style.display = 'block'; loadTestimoni(); }
        async function loadTestimoni() {
            const box = document.getElementById('testi-list');
            const { data } = await _s.from('testimonis').select('*').order('id', { ascending: false });
            if (!data || !data.length) { box.innerHTML = `<div style="text-align:center; padding:20px; opacity:0.6; font-weight:700;">BELUM ADA TESTIMONI</div>`; return; }
            let html = ''; data.forEach(t => { html += `<div style="background:rgba(255,255,255,0.03); border-radius:18px; padding:15px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.05); text-align:left;"><div style="display:flex; align-items:center; gap:10px; margin-bottom:8px; font-weight:800; color:var(--gold);"><i class="fas fa-user-check"></i> ${t.nama_buyer}</div><div>${t.pesan}</div>${t.image_url ? `<img src="${t.image_url}" style="width:100%; border-radius:12px; margin-top:10px;">` : ''}</div>`; });
            box.innerHTML = html;
        }

        function opCalc() { cls(); document.getElementById('m-calc').style.display = 'block'; document.getElementById('ov').style.display = 'block'; }
        function calcIn(v) { document.getElementById('calc-display').value += v; }
        function calcClear() { document.getElementById('calc-display').value = ''; }
        function calcRes() { try { document.getElementById('calc-display').value = eval(document.getElementById('calc-display').value); } catch(e) { calcClear(); } }
        function opRed() { cls(); document.getElementById('m-red').style.display = 'block'; document.getElementById('ov').style.display = 'block'; }
        function opReq() { cls(); document.getElementById('m-req').style.display = 'block'; document.getElementById('ov').style.display = 'block'; }
        function opAi() { cls(); document.getElementById('m-ai').style.display = 'block'; document.getElementById('ov').style.display = 'block'; }
        
        function askAi() {
            const input = document.getElementById('chat-in'), box = document.getElementById('chat-box'), txt = input.value.toLowerCase();
            if(!txt) return;
            box.innerHTML += `<div style="text-align:right; margin-bottom:10px;"><b>User:</b> ${input.value}</div>`;
            let res = "Belum paham bang. Tanya: Saldo, Cara Beli, Jasa Post, atau Stok.";
            const temps = [
    { k: ['halo', 'hi', 'hai', 'p', 'assalamualaikum'], r: "Halo bang! Dika Store siap melayani." },
    { k: ['beli', 'cara beli', 'order'], r: "Klik BELI, kalau saldo cukup data muncul di RIWAYAT." },
    { k: ['saldo', 'topup', 'isi saldo'], r: "Isi via REDEEM KODE. Beli kodenya di WA Admin." },
    { k: ['jasa post', 'titip', 'promosi'], r: "Gunakan menu JASA POST di sidebar bang." },
    { k: ['aman', 'trusted', 'penipuan'], r: "100% aman dan otomatis bang." },
    { k: ['stok', 'ready', 'tersedia'], r: "Cek katalog, kalau ada tombol BELI berarti ready." },
    { k: ['admin', 'wa', 'kontak'], r: `WA Admin: ${adminWA}` },

    { k: ['refund', 'balik dana'], r: "Refund hanya berlaku kalau sistem error, bukan karena salah beli." },
    { k: ['garansi', 'jaminan'], r: "Ada garansi sesuai produk, cek deskripsi ya bang." },
    { k: ['lama', 'proses'], r: "Proses otomatis, biasanya instan 1-5 detik." },
    { k: ['error', 'gagal'], r: "Kalau error kirim screenshot ke admin." },
    { k: ['login', 'masuk'], r: "Pastikan email & password bener sesuai data yang dikirim." },
    { k: ['akun', 'account'], r: "Akun dikirim otomatis ke RIWAYAT." },
    { k: ['riwayat', 'history'], r: "Semua pembelian bisa dicek di menu RIWAYAT." },
    { k: ['katalog', 'list'], r: "Cek semua produk di menu KATALOG." },
    { k: ['murah', 'harga'], r: "Harga sudah paling murah, jangan banding-bandingin sama tukang tipu." },
    { k: ['reseller', 'dropship'], r: "Bisa reseller, hubungi admin buat harga khusus." },
    { k: ['metode', 'pembayaran'], r: "Metode pembayaran: Dana, OVO, Gopay (lihat menu TOPUP)." },
    { k: ['full', 'habis'], r: "Kalau habis berarti lagi kosong, tunggu restock." },
    { k: ['restock'], r: "Restock random, pantengin katalog ya." },
    { k: ['bukti', 'testimoni'], r: "Testimoni ada di channel/testi resmi." },
    { k: ['cancel', 'batal'], r: "Transaksi yang sudah diproses tidak bisa dibatalkan." },
    { k: ['jam', 'online'], r: "Bot 24 jam, admin manusia butuh tidur." },
    { k: ['delay', 'lama banget'], r: "Kalau delay biasanya server provider, bukan botnya." },
    { k: ['password', 'pw'], r: "Jangan ganti password sebelum login berhasil." },
    { k: ['email'], r: "Email dikirim sesuai data produk yang dibeli." },
    { k: ['help', 'tolong'], r: "Gunakan menu HELP atau chat admin." },
    { k: ['thanks', 'makasih'], r: "Sama-sama bang, semoga langganan." },
    { k: ['owner'], r: "Owner: Dika (yang capek bikin sistem ini)." }
      ];
            temps.forEach(t => { if(t.k.some(key => txt.includes(key))) res = t.r; });
            setTimeout(() => { box.innerHTML += `<div style="color:var(--blue); margin-bottom:10px;"><b>Dika AI:</b> ${res}</div>`; box.scrollTop = box.scrollHeight; }, 400);
            input.value = '';
        }

        async function redeem() {
            const code = document.getElementById('red-code').value;
            const { data: rc } = await _s.from('redeem_codes').select('*').eq('code', code).eq('is_used', false).single();
            if(!rc) return msg("Kode salah!");
            await _s.from('profiles').update({ balance: userBalance + rc.value }).eq('email', mail);
            await _s.from('redeem_codes').update({ is_used: true, used_by: mail }).eq('id', rc.id);
            msg("Berhasil!"); location.reload();
        }

        async function showTop() {
            cls(); document.getElementById('m-top').style.display = 'block'; document.getElementById('ov').style.display = 'block';
            const { data } = await _s.from('orders').select('user_email, price');
            const stats = (data || []).reduce((acc, c) => { const n = c.user_email.split('@')[0]; acc[n] = (acc[n] || 0) + c.price; return acc; }, {});
            const sorted = Object.entries(stats).sort((a,b) => b[1]-a[1]).slice(0,5);
            let html = ''; sorted.forEach(([n, p], i) => { html += `<div style="padding:10px; background:rgba(255,255,255,0.05); margin-bottom:5px; border-radius:10px;">#${i+1} <b>${n}</b> - Rp ${p.toLocaleString()}</div>`; });
            document.getElementById('top-list').innerHTML = html || 'Belum ada sultan.';
        }

        function search() { const v = document.getElementById('searchInput').value.toLowerCase(); renderProducts(allProducts.filter(p => p.name.toLowerCase().includes(v))); }
        async function checkAdmin() { const { data } = await _s.from('profiles').select('role').eq('email', mail).single(); if(data?.role === 'admin') document.getElementById('adm-menu').innerHTML = `<button class="side-btn" onclick="location.href='admin.html'">ADMIN PANEL</button>`; }
        function logout() { localStorage.clear(); location.href = 'index.html'; }
        loadData(); checkAdmin();
    </script>
</body>
</html>